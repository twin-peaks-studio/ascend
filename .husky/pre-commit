#!/bin/sh

# Pre-commit hook: Enforce code quality standards
# This runs automatically before every commit

echo "üîç Running pre-commit checks..."

# Run TypeScript type checking
echo "  ‚Üí Type checking..."
npm run type-check || {
  echo "‚ùå Type check failed. Fix errors before committing."
  exit 1
}

# Run ESLint
echo "  ‚Üí Linting..."
npm run lint || {
  echo "‚ùå ESLint failed. Fix errors before committing."
  exit 1
}

# Check for console.* statements in non-logger files
echo "  ‚Üí Checking for console statements..."
STAGED_TS_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx)$' | grep -v 'lib/logger' || true)

if [ -n "$STAGED_TS_FILES" ]; then
  CONSOLE_VIOLATIONS=$(echo "$STAGED_TS_FILES" | xargs grep -n 'console\.' 2>/dev/null || true)

  if [ -n "$CONSOLE_VIOLATIONS" ]; then
    echo "‚ùå Found console.* statements in staged files (outside logger utilities):"
    echo "$CONSOLE_VIOLATIONS"
    echo ""
    echo "   Replace with logger.info/debug/error or remove debugging code"
    exit 1
  fi
fi

echo "‚úÖ Pre-commit checks passed!"
exit 0
